<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>cry 2.0</title>
	</head>
	<body>
		<h1>cry 2.0</h1>
		
		<h3>Encript / Decript</h3>
		<input id="msgEn" placeholder="Mensagem">
		<input id="keyEn" placeholder="Chave">
		<button id="encript">Encript.</button><br>
		<p id="encripted"></p>
	</body>

	<script>
		document.addEventListener('DOMContentLoaded', function() {
		
			var alfanum = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFTGIJKLMNOPQRSTUVWXYZáàãâéèêíìîóòõôúùûçÁÀÃÂÉÈÊÍÌÎÓÒÕÔÚÙÛÇ.,:;/\\\'\"?!@#$%&*\(\)\[\]\{\}=+-_´`~^ ';
			
			function codigoChar(letra) {
			
				var codigo;
				for (var x = 0; x < alfanum.length; x++) {
					if (letra == alfanum[x]) {
						codigo = x;
					}
				}
				
				return codigo;
			}
			
			function charCodigo(codigo) {
				
				return alfanum[codigo];
			}
		
			// encript
			var encriptao = document.getElementById('encript');
			var encriptasso = document.getElementById('encripted');
			
			encriptao.addEventListener('click', function(e) {
			
				var msg = document.getElementById('msgEn').value;
				console.log('Mensagem: ' + msg);
				
				var msgCod = [];
				for (var x = 0; x < msg.length; x++) {
					msgCod.push(codigoChar(msg[x]));
				}
				console.log('Mensagem codificada: ' + msgCod.join(' '));
				
				var chave = document.getElementById('keyEn').value;
				console.log('Chave: ' + chave);
				
				var qtdChaves = parseInt(msg.length / chave.length);
				console.log('Chaves a repetir: ' + qtdChaves);
				
				var faltaChars = msg.length % chave.length;
				console.log('Caracteres faltando para completar a chave: ' + faltaChars);
				
				var chaveDef = '';
				for (var x = 0; x < qtdChaves; x++) {
					chaveDef += chave;
				}
				for (var x = 0; x < faltaChars; x++) {
					chaveDef += chave[x]
				}
				console.log('Chave definitiva: ' + chaveDef);
				
				var chaveCod = [];
				for (var x = 0; x < chaveDef.length; x++) {
					chaveCod.push(codigoChar(chaveDef[x]));
				}
				console.log('Chave codificada: ' + chaveCod.join(' '));
				
				var msgCodXORed = [];
				for (var x = 0; x < chaveCod.length; x++) {
					msgCodXORed.push(parseInt(parseInt((chaveCod[x] ^ msgCod[x]).toString(2)), 2));
				}
				console.log('Mensagem criptografada em codigo: ' + msgCodXORed.join(' '));
				
				var msgEncripted = '';
				for (var x = 0; x < msgCodXORed.length; x++) {
					msgEncripted += charCodigo(msgCodXORed[x]);
				}
				console.log('Mensagem criptografada: ' + msgEncripted);
				encriptasso.innerHTML = msgEncripted;
			});
		
		});
	</script>
</html>